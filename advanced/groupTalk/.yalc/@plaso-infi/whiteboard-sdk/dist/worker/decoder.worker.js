!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(){this.wasmLoaded=!1,this.tmpReqQue=[]}self.Module={onRuntimeInitialized:function(){self.decoder&&self.decoder.onWasmLoaded()}},self.importScripts("https://wwwr.plaso.cn/infi_board/libffmpeg.js"),e.prototype.initDecoders=function(){Module._initDecoders()},e.prototype.openDecoder=function(e,o){var t=new Uint8Array(o),s=Module._malloc(t.length);Module.HEAPU8.set(t,s);var d={index:e,t:0,e:Module._openDecoder(e,s,t.length)};self.postMessage(d),Module._free(s)},e.prototype.closeDecoder=function(e){Module._closeDecoder(e);var o={index:e,t:1,e:0};self.postMessage(o)},e.prototype.decode=function(e,o){var t=Module._decodeOnePacket(e,o),s=Module.HEAPU32[t/4],d=Module.HEAPU32[t/4+1];if(s>0&&d>0){var n=Module.HEAPU32[t/4+2],i=Module.HEAPU32[t/4+3],c=Module.HEAPU8.subarray(t+16,t+16+s*d*4),r={index:e,t:2,e:n,s:i,d:new Uint8Array(c),w:s,h:d};self.postMessage(r)}else{r={index:e,t:3};self.postMessage(r)}},e.prototype.processReq=function(e){switch(e.t){case 0:this.openDecoder(e.index,e.d);break;case 1:this.closeDecoder(e.index);break;case 2:this.decode(e.index,e.loop)}},e.prototype.cacheReq=function(e){e&&this.tmpReqQue.push(e)},e.prototype.onWasmLoaded=function(){for(this.wasmLoaded=!0,this.initDecoders();this.tmpReqQue.length>0;){var e=this.tmpReqQue.shift();this.processReq(e)}},self.decoder=new e,self.onmessage=function(e){if(self.decoder){var o=e.data;self.decoder.wasmLoaded?self.decoder.processReq(o):self.decoder.cacheReq(o)}}}));
